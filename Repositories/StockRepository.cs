using System;

using System.Threading.Tasks;

using Microsoft.Extensions.Configuration;
using RealTime_StockExchange.Interfaces;
using RealTime_StockExchange.Models;
using Microsoft.EntityFrameworkCore;
using StockUpdates.Context;
using System.Linq;
using System.Collections.Generic;

namespace RealTime_StockExchange.Repositories
{
    public class StockRepository : IStockRepository
    {
        private StockUpdatesContext _context = null;
        private DbSet<Stock> _stocks = null;
        private readonly IConfiguration _configuration;


        public StockRepository()
        {
            this._context = new StockUpdatesContext();

            _stocks = _context.Stocks;
        }

        public async Task<Stock> AddStock(Stock _obj)
            {

            DateTime DateTime_ = DateTime.Now;

         
                try
                {


                    _context.Add(_obj);
                    await _context.SaveChangesAsync();
                }


                catch (Exception ex)
                {


                    Console.Write("An error occured");
                }
            
            return _obj;
        }


        public async Task<List<Stock>> GetAllStocks()
        {
            var stock = new List<Stock>();

            DateTime DateTime_ = DateTime.Now;

            try
            {


                 stock = await _stocks.ToListAsync();


            }
            catch (Exception ex)
            {
                throw ex;
            }

            return stock;
        }
        public async Task<Stock> GetLatestStock()
        {
            var stock =new List<Stock>();
            
            DateTime DateTime_ = DateTime.Now;

            try
            {


                var final = _stocks.Max(x=>x.Id);
                 stock = _stocks.Where(x => x.Id == final).ToList();  
                

            }
            catch (Exception ex)
            {
                Console.Write("An error occured");
            }

            return stock[0];
        }


    


    









    }
}
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































